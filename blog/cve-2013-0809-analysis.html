<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CVE-2013-0809 Analysis | Fuzzing.in</title>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-82JZEHCFPE"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-82JZEHCFPE');
    </script>
    <meta name="description" content="There are lots of fix in the code, should be self explantory:

     1.1 --- a/src/share/classes/sun/awt/image/ByteComponentRaster.java	Tue Dec 04 14:02:08 2012 ...">
    <meta name="keywords" content="cve-2013-0809">
    <meta name="author" content="Hardik Shah">
    <link rel="canonical" href="https://fuzzing.in/blog/cve-2013-0809-analysis.html">
    
    <!-- Open Graph -->
    <meta property="og:type" content="article">
    <meta property="og:title" content="CVE-2013-0809 Analysis | Fuzzing.in">
    <meta property="og:description" content="There are lots of fix in the code, should be self explantory:

     1.1 --- a/src/share/classes/sun/awt/image/ByteComponentRaster.java	Tue Dec 04 14:02:08 2012 ...">
    <meta property="og:image" content="https://fuzzing.in/images/logo.jpg">
    <meta property="og:url" content="https://fuzzing.in/blog/cve-2013-0809-analysis.html">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:title" content="CVE-2013-0809 Analysis | Fuzzing.in">
    <meta property="twitter:description" content="There are lots of fix in the code, should be self explantory:

     1.1 --- a/src/share/classes/sun/awt/image/ByteComponentRaster.java	Tue Dec 04 14:02:08 2012 ...">
    <meta property="twitter:image" content="https://fuzzing.in/images/logo.jpg">

    <link rel="icon" href="../images/logo.jpg" type="image/jpeg">
    
    <!-- Tailwind CSS with Typography Plugin -->
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <script>
        tailwind.config = { 
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        };
    </script>
    <script src="../js/nav.js" defer></script>
    
    <style>
        body { font-family: 'Inter', sans-serif; }
        /* Custom scrollbar for code blocks */
        pre::-webkit-scrollbar { height: 8px; }
        pre::-webkit-scrollbar-track { background: #374151; border-radius: 4px; }
        pre::-webkit-scrollbar-thumb { background: #6b7280; border-radius: 4px; }
    </style>
</head>
<body class="py-4 md:py-10 px-2 bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300">

    <!-- Header (Paths adjusted with ../ for subdirectory) -->
    <header class="sticky top-0 z-50 bg-white/95 dark:bg-gray-900/95 backdrop-blur-sm border-b border-gray-200 dark:border-gray-800 transition-colors duration-300">
        <div class="container mx-auto flex justify-between items-center p-4 md:p-6">
            <a href="../index.html" class="flex items-center gap-3 text-3xl font-extrabold text-blue-500 tracking-widest">
                <img src="../images/logo.jpg" alt="Fuzzing.in Logo" class="h-10 w-10 rounded-full object-cover border-2 border-blue-500">
                FUZZING.IN
            </a>
            <nav class="hidden md:flex space-x-6 text-sm font-medium">
                <a href="../index.html" class="hover:text-blue-400 transition">Home</a>
                <a href="../trainings.html" class="hover:text-blue-400 transition">Trainings</a>
                <a href="../blog.html" class="hover:text-blue-400 transition text-blue-400 font-bold">Blog</a>
                <a href="../advisories.html" class="hover:text-blue-400 transition">Advisories</a>
                <a href="../patents.html" class="hover:text-blue-400 transition">Patents</a>
                <a href="../publications.html" class="hover:text-blue-400 transition">Publications</a>
                <a href="../media.html" class="hover:text-blue-400 transition">Media</a>
                <a href="../about.html" class="hover:text-blue-400 transition">About</a>
                <a href="../contact.html" class="hover:text-blue-400 transition">Contact</a>
                <a href="../contact.html" class="px-3 py-1 bg-emerald-600 text-white rounded-full hover:bg-emerald-500 transition shadow-md">Private Training</a>
                <button id="theme-toggle" class="text-gray-500 dark:text-gray-300 hover:text-blue-400 transition ml-4">
                    <i class="fas fa-moon theme-toggle-icon"></i>
                </button>
            </nav>
            <button class="md:hidden text-2xl text-gray-900 dark:text-white"><i class="fas fa-bars"></i></button>
        </div>
    </header>

    <main class="container mx-auto p-4 md:p-8 max-w-4xl">
        
        <!-- Breadcrumb / Back Link -->
        <div class="mb-8">
            <a href="../blog.html" class="text-blue-500 hover:text-blue-400 font-semibold flex items-center gap-2">
                <i class="fas fa-arrow-left"></i> Back to Blog
            </a>
        </div>

        <!-- Article Header -->
        <header class="mb-10 text-center md:text-left">
            <span class="inline-block px-3 py-1 bg-pink-100 dark:bg-pink-900/30 text-pink-600 dark:text-pink-400 rounded-full text-xs font-bold uppercase tracking-widest mb-4">
                0 day analysis
            </span>
            <h1 class="text-3xl md:text-5xl font-extrabold text-gray-900 dark:text-white mb-6 leading-tight">
                CVE-2013-0809 Analysis
            </h1>
            <div class="flex flex-wrap items-center gap-6 text-gray-500 dark:text-gray-400 text-sm">
                <div class="flex items-center gap-2">
                    <img src="../images/hardik.webp" alt="Author" class="w-8 h-8 rounded-full border border-gray-300 dark:border-gray-600 object-cover">
                    <span class="font-medium text-gray-900 dark:text-gray-200">Hardik Shah</span>
                </div>
                <span class="hidden md:inline">•</span>
                <div class="flex items-center gap-2">
                    <i class="far fa-calendar-alt"></i>
                    <span>April 12, 2013</span>
                </div>
                <span class="hidden md:inline">•</span>
                <div class="flex items-center gap-2">
                    <i class="far fa-clock"></i>
                    <span>63 min read</span>
                </div>
                
                <!-- Share Buttons -->
                <div class="flex items-center gap-3 md:ml-auto">
                    <a href="#" id="share-twitter" target="_blank" class="text-gray-500 hover:text-blue-400 transition text-lg" title="Share on Twitter">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="#" id="share-linkedin" target="_blank" class="text-gray-500 hover:text-blue-700 transition text-lg" title="Share on LinkedIn">
                        <i class="fab fa-linkedin"></i>
                    </a>
                    <a href="#" id="share-facebook" target="_blank" class="text-gray-500 hover:text-blue-600 transition text-lg" title="Share on Facebook">
                        <i class="fab fa-facebook"></i>
                    </a>
                    <a href="#" id="share-email" class="text-gray-500 hover:text-red-500 transition text-lg" title="Share via Email">
                        <i class="fas fa-envelope"></i>
                    </a>
                    <button id="copy-link-btn" class="text-gray-500 hover:text-gray-900 dark:hover:text-white transition text-lg" title="Copy Link">
                        <i class="fas fa-link"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Featured Image (Optional) -->
        <div class="mb-10 rounded-xl overflow-hidden shadow-lg border border-gray-200 dark:border-gray-700">
            <!-- FEATURED_IMAGE_START -->
            <div class="bg-gray-100 dark:bg-gray-800 h-64 md:h-96 flex items-center justify-center text-gray-400">
                <i class="fas fa-image text-6xl"></i>
                <!-- <img src="../images/blog/your-image.jpg" alt="Cover Image" class="w-full h-full object-cover"> -->
            </div>
            <!-- FEATURED_IMAGE_END -->
        </div>

        <!-- Table of Contents -->
        <div id="toc" class="hidden mb-10 p-6 bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700">
            <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4 border-b border-gray-200 dark:border-gray-700 pb-2">Table of Contents</h3>
            <nav>
                <ul id="toc-list" class="space-y-2 text-sm text-gray-600 dark:text-gray-300"></ul>
            </nav>
        </div>

        <!-- Article Content -->
        <!-- 'prose' class activates Tailwind Typography plugin -->
        <article class="prose prose-lg prose-slate dark:prose-invert max-w-none">
            <!-- CONTENT_START -->
There are lots of fix in the code, should be self explantory:
<div>
<pre><a id="l1.1" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l1.1">     1.1</a> --- a/src/share/classes/sun/awt/image/ByteComponentRaster.java	Tue Dec 04 14:02:08 2012 +0000
<a id="l1.2" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l1.2">     1.2</a> +++ b/src/share/classes/sun/awt/image/ByteComponentRaster.java	Thu Feb 14 19:51:51 2013 +0400
<a id="l1.3" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l1.3">     1.3</a> @@ -868,6 +868,15 @@
<a id="l1.4" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l1.4">     1.4</a>       * or if data buffer has not enough capacity.
<a id="l1.5" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l1.5">     1.5</a>       */
<a id="l1.6" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l1.6">     1.6</a>      protected final void verify() {
<a id="l1.7" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l1.7">     1.7</a> +        /* Need to re-verify the dimensions since a sample model may be
<a id="l1.8" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l1.8">     1.8</a> +         * specified to the constructor
<a id="l1.9" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l1.9">     1.9</a> +         */
<a id="l1.10" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l1.10">    1.10</a> +        if (width &lt;= 0 || height &lt;= 0 ||
<a id="l1.11" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l1.11">    1.11</a> +            height &gt; (Integer.MAX_VALUE / width))
<a id="l1.12" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l1.12">    1.12</a> +        {
<a id="l1.13" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l1.13">    1.13</a> +            throw new RasterFormatException("Invalid raster dimension");
<a id="l1.14" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l1.14">    1.14</a> +        }
<a id="l1.15" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l1.15">    1.15</a> +
<a id="l1.16" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l1.16">    1.16</a>          for (int i = 0; i &lt; dataOffsets.length; i++) {
<a id="l1.17" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l1.17">    1.17</a>              if (dataOffsets[i] &lt; 0) {
<a id="l1.18" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l1.18">    1.18</a>                  throw new RasterFormatException("Data offsets for band " + i
<a id="l1.19" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l1.19">    1.19</a> @@ -905,13 +914,14 @@
<a id="l1.20" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l1.20">    1.20</a>          lastPixelOffset += lastScanOffset;
<a id="l1.21" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l1.21">    1.21</a>  
<a id="l1.22" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l1.22">    1.22</a>          for (int i = 0; i &lt; numDataElements; i++) {
<a id="l1.23" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l1.23">    1.23</a> -            size = lastPixelOffset + dataOffsets[i];
<a id="l1.24" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l1.24">    1.24</a>              if (dataOffsets[i] &gt; (Integer.MAX_VALUE - lastPixelOffset)) {
<a id="l1.25" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l1.25">    1.25</a>                  throw new RasterFormatException("Incorrect band offset: "
<a id="l1.26" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l1.26">    1.26</a>                              + dataOffsets[i]);
<a id="l1.27" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l1.27">    1.27</a>  
<a id="l1.28" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l1.28">    1.28</a>              }
<a id="l1.29" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l1.29">    1.29</a>  
<a id="l1.30" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l1.30">    1.30</a> +            size = lastPixelOffset + dataOffsets[i];
<a id="l1.31" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l1.31">    1.31</a> +
<a id="l1.32" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l1.32">    1.32</a>              if (size &gt; maxSize) {
<a id="l1.33" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l1.33">    1.33</a>                  maxSize = size;
<a id="l1.34" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l1.34">    1.34</a>              }</pre>
</div>
<div>
<pre><a id="l2.1" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l2.1">     2.1</a> --- a/src/share/classes/sun/awt/image/BytePackedRaster.java	Tue Dec 04 14:02:08 2012 +0000
<a id="l2.2" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l2.2">     2.2</a> +++ b/src/share/classes/sun/awt/image/BytePackedRaster.java	Thu Feb 14 19:51:51 2013 +0400
<a id="l2.3" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l2.3">     2.3</a> @@ -1368,11 +1368,35 @@
<a id="l2.4" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l2.4">     2.4</a>              throw new RasterFormatException("Data offsets must be &gt;= 0");
<a id="l2.5" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l2.5">     2.5</a>          }
<a id="l2.6" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l2.6">     2.6</a>  
<a id="l2.7" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l2.7">     2.7</a> +        /* Need to re-verify the dimensions since a sample model may be
<a id="l2.8" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l2.8">     2.8</a> +         * specified to the constructor
<a id="l2.9" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l2.9">     2.9</a> +         */
<a id="l2.10" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l2.10">    2.10</a> +        if (width &lt;= 0 || height &lt;= 0 ||
<a id="l2.11" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l2.11">    2.11</a> +            height &gt; (Integer.MAX_VALUE / width))
<a id="l2.12" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l2.12">    2.12</a> +        {
<a id="l2.13" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l2.13">    2.13</a> +            throw new RasterFormatException("Invalid raster dimension");
<a id="l2.14" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l2.14">    2.14</a> +        }
<a id="l2.15" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l2.15">    2.15</a> +
<a id="l2.16" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l2.16">    2.16</a> +
<a id="l2.17" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l2.17">    2.17</a> +        /*
<a id="l2.18" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l2.18">    2.18</a> +         * pixelBitstride was verified in constructor, so just make
<a id="l2.19" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l2.19">    2.19</a> +         * sure that it is safe to multiply it by width.
<a id="l2.20" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l2.20">    2.20</a> +         */
<a id="l2.21" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l2.21">    2.21</a> +        if ((width - 1) &gt; Integer.MAX_VALUE / pixelBitStride) {
<a id="l2.22" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l2.22">    2.22</a> +            throw new RasterFormatException("Invalid raster dimension");
<a id="l2.23" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l2.23">    2.23</a> +        }
<a id="l2.24" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l2.24">    2.24</a> +
<a id="l2.25" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l2.25">    2.25</a> +        if (scanlineStride &lt; 0 ||
<a id="l2.26" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l2.26">    2.26</a> +            scanlineStride &gt; (Integer.MAX_VALUE / height))
<a id="l2.27" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l2.27">    2.27</a> +        {
<a id="l2.28" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l2.28">    2.28</a> +            throw new RasterFormatException("Invalid scanline stride");
<a id="l2.29" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l2.29">    2.29</a> +        }
<a id="l2.30" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l2.30">    2.30</a> +
<a id="l2.31" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l2.31">    2.31</a>          int lastbit = (dataBitOffset
<a id="l2.32" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l2.32">    2.32</a>                         + (height-1) * scanlineStride * 8
<a id="l2.33" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l2.33">    2.33</a>                         + (width-1) * pixelBitStride
<a id="l2.34" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l2.34">    2.34</a>                         + pixelBitStride - 1);
<a id="l2.35" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l2.35">    2.35</a> -        if (lastbit / 8 &gt;= data.length) {
<a id="l2.36" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l2.36">    2.36</a> +        if (lastbit &lt; 0 || lastbit / 8 &gt;= data.length) {
<a id="l2.37" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l2.37">    2.37</a>              throw new RasterFormatException("raster dimensions overflow " +
<a id="l2.38" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l2.38">    2.38</a>                                              "array bounds");
<a id="l2.39" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l2.39">    2.39</a>          }</pre>
</div>
<div>
<pre><a id="l3.1" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.1">     3.1</a> --- a/src/share/classes/sun/awt/image/IntegerComponentRaster.java	Tue Dec 04 14:02:08 2012 +0000
<a id="l3.2" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.2">     3.2</a> +++ b/src/share/classes/sun/awt/image/IntegerComponentRaster.java	Thu Feb 14 19:51:51 2013 +0400
<a id="l3.3" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.3">     3.3</a> @@ -208,7 +208,7 @@
<a id="l3.4" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.4">     3.4</a>                                              " SinglePixelPackedSampleModel");
<a id="l3.5" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.5">     3.5</a>          }
<a id="l3.6" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.6">     3.6</a>  
<a id="l3.7" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.7">     3.7</a> -        verify(false);
<a id="l3.8" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.8">     3.8</a> +        verify();
<a id="l3.9" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.9">     3.9</a>      }
<a id="l3.10" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.10">    3.10</a>  
<a id="l3.11" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.11">    3.11</a>  
<a id="l3.12" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.12">    3.12</a> @@ -629,16 +629,26 @@
<a id="l3.13" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.13">    3.13</a>      }
<a id="l3.14" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.14">    3.14</a>  
<a id="l3.15" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.15">    3.15</a>      /**
<a id="l3.16" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.16">    3.16</a> -     * Verify that the layout parameters are consistent with
<a id="l3.17" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.17">    3.17</a> -     * the data.  If strictCheck
<a id="l3.18" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.18">    3.18</a> -     * is false, this method will check for ArrayIndexOutOfBounds conditions.  If
<a id="l3.19" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.19">    3.19</a> -     * strictCheck is true, this method will check for additional error
<a id="l3.20" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.20">    3.20</a> -     * conditions such as line wraparound (width of a line greater than
<a id="l3.21" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.21">    3.21</a> -     * the scanline stride).
<a id="l3.22" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.22">    3.22</a> -     * @return   String   Error string, if the layout is incompatible with
<a id="l3.23" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.23">    3.23</a> -     *                    the data.  Otherwise returns null.
<a id="l3.24" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.24">    3.24</a> +     * Verify that the layout parameters are consistent with the data.
<a id="l3.25" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.25">    3.25</a> +     *
<a id="l3.26" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.26">    3.26</a> +     * The method verifies whether scanline stride and pixel stride do not
<a id="l3.27" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.27">    3.27</a> +     * cause an integer overflow during calculation of a position of the pixel
<a id="l3.28" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.28">    3.28</a> +     * in data buffer. It also verifies whether the data buffer has enough data
<a id="l3.29" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.29">    3.29</a> +     *  to correspond the raster layout attributes.
<a id="l3.30" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.30">    3.30</a> +     *
<a id="l3.31" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.31">    3.31</a> +     * @throws RasterFormatException if an integer overflow is detected,
<a id="l3.32" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.32">    3.32</a> +     * or if data buffer has not enough capacity.
<a id="l3.33" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.33">    3.33</a>       */
<a id="l3.34" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.34">    3.34</a> -    private void verify (boolean strictCheck) {
<a id="l3.35" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.35">    3.35</a> +    protected final void verify() {
<a id="l3.36" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.36">    3.36</a> +        /* Need to re-verify the dimensions since a sample model may be
<a id="l3.37" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.37">    3.37</a> +         * specified to the constructor
<a id="l3.38" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.38">    3.38</a> +         */
<a id="l3.39" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.39">    3.39</a> +        if (width &lt;= 0 || height &lt;= 0 ||
<a id="l3.40" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.40">    3.40</a> +            height &gt; (Integer.MAX_VALUE / width))
<a id="l3.41" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.41">    3.41</a> +        {
<a id="l3.42" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.42">    3.42</a> +            throw new RasterFormatException("Invalid raster dimension");
<a id="l3.43" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.43">    3.43</a> +        }
<a id="l3.44" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.44">    3.44</a> +
<a id="l3.45" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.45">    3.45</a>          if (dataOffsets[0] &lt; 0) {
<a id="l3.46" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.46">    3.46</a>              throw new RasterFormatException("Data offset ("+dataOffsets[0]+
<a id="l3.47" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.47">    3.47</a>                                              ") must be &gt;= 0");
<a id="l3.48" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.48">    3.48</a> @@ -647,17 +657,46 @@
<a id="l3.49" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.49">    3.49</a>          int maxSize = 0;
<a id="l3.50" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.50">    3.50</a>          int size;
<a id="l3.51" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.51">    3.51</a>  
<a id="l3.52" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.52">    3.52</a> -        for (int i=0; i &lt; numDataElements; i++) {
<a id="l3.53" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.53">    3.53</a> -            size = (height-1)*scanlineStride + (width-1)*pixelStride +
<a id="l3.54" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.54">    3.54</a> -                dataOffsets[i];
<a id="l3.55" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.55">    3.55</a> +        // we can be sure that width and height are greater than 0
<a id="l3.56" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.56">    3.56</a> +        if (scanlineStride &lt; 0 ||
<a id="l3.57" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.57">    3.57</a> +            scanlineStride &gt; (Integer.MAX_VALUE / height))
<a id="l3.58" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.58">    3.58</a> +        {
<a id="l3.59" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.59">    3.59</a> +            // integer overflow
<a id="l3.60" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.60">    3.60</a> +            throw new RasterFormatException("Incorrect scanline stride: "
<a id="l3.61" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.61">    3.61</a> +                    + scanlineStride);
<a id="l3.62" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.62">    3.62</a> +        }
<a id="l3.63" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.63">    3.63</a> +        int lastScanOffset = (height - 1) * scanlineStride;
<a id="l3.64" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.64">    3.64</a> +
<a id="l3.65" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.65">    3.65</a> +        if (pixelStride &lt; 0 ||
<a id="l3.66" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.66">    3.66</a> +            pixelStride &gt; (Integer.MAX_VALUE / width))
<a id="l3.67" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.67">    3.67</a> +        {
<a id="l3.68" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.68">    3.68</a> +            // integer overflow
<a id="l3.69" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.69">    3.69</a> +            throw new RasterFormatException("Incorrect pixel stride: "
<a id="l3.70" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.70">    3.70</a> +                    + pixelStride);
<a id="l3.71" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.71">    3.71</a> +        }
<a id="l3.72" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.72">    3.72</a> +        int lastPixelOffset = (width - 1) * pixelStride;
<a id="l3.73" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.73">    3.73</a> +
<a id="l3.74" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.74">    3.74</a> +        if (lastPixelOffset &gt; (Integer.MAX_VALUE - lastScanOffset)) {
<a id="l3.75" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.75">    3.75</a> +            // integer overflow
<a id="l3.76" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.76">    3.76</a> +            throw new RasterFormatException("Incorrect raster attributes");
<a id="l3.77" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.77">    3.77</a> +        }
<a id="l3.78" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.78">    3.78</a> +        lastPixelOffset += lastScanOffset;
<a id="l3.79" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.79">    3.79</a> +
<a id="l3.80" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.80">    3.80</a> +        for (int i = 0; i &lt; numDataElements; i++) {
<a id="l3.81" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.81">    3.81</a> +            if (dataOffsets[i] &gt; (Integer.MAX_VALUE - lastPixelOffset)) {
<a id="l3.82" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.82">    3.82</a> +                throw new RasterFormatException("Incorrect band offset: "
<a id="l3.83" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.83">    3.83</a> +                            + dataOffsets[i]);
<a id="l3.84" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.84">    3.84</a> +            }
<a id="l3.85" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.85">    3.85</a> +
<a id="l3.86" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.86">    3.86</a> +            size = lastPixelOffset + dataOffsets[i];
<a id="l3.87" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.87">    3.87</a> +
<a id="l3.88" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.88">    3.88</a>              if (size &gt; maxSize) {
<a id="l3.89" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.89">    3.89</a>                  maxSize = size;
<a id="l3.90" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.90">    3.90</a>              }
<a id="l3.91" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.91">    3.91</a>          }
<a id="l3.92" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.92">    3.92</a>          if (data.length &lt; maxSize) {
<a id="l3.93" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.93">    3.93</a> -            throw new RasterFormatException("Data array too small (should be "+
<a id="l3.94" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.94">    3.94</a> -                                          maxSize
<a id="l3.95" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.95">    3.95</a> -                                          +" but is "+data.length+" )");
<a id="l3.96" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.96">    3.96</a> +            throw new RasterFormatException("Data array too small (should be "
<a id="l3.97" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.97">    3.97</a> +                    + maxSize + " )");
<a id="l3.98" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.98">    3.98</a>          }
<a id="l3.99" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.99">    3.99</a>      }
<a id="l3.100" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l3.100">   3.100</a></pre>
</div>
<div>
<pre><a id="l4.1" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.1">     4.1</a> --- a/src/share/classes/sun/awt/image/IntegerInterleavedRaster.java	Tue Dec 04 14:02:08 2012 +0000
<a id="l4.2" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.2">     4.2</a> +++ b/src/share/classes/sun/awt/image/IntegerInterleavedRaster.java	Thu Feb 14 19:51:51 2013 +0400
<a id="l4.3" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.3">     4.3</a> @@ -151,7 +151,7 @@
<a id="l4.4" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.4">     4.4</a>              throw new RasterFormatException("IntegerInterleavedRasters must have"+
<a id="l4.5" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.5">     4.5</a>                                              " SinglePixelPackedSampleModel");
<a id="l4.6" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.6">     4.6</a>          }
<a id="l4.7" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.7">     4.7</a> -        verify(false);
<a id="l4.8" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.8">     4.8</a> +        verify();
<a id="l4.9" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.9">     4.9</a>      }
<a id="l4.10" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.10">    4.10</a>  
<a id="l4.11" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.11">    4.11</a>  
<a id="l4.12" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.12">    4.12</a> @@ -540,31 +540,6 @@
<a id="l4.13" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.13">    4.13</a>          return createCompatibleWritableRaster(width,height);
<a id="l4.14" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.14">    4.14</a>      }
<a id="l4.15" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.15">    4.15</a>  
<a id="l4.16" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.16">    4.16</a> -    /**
<a id="l4.17" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.17">    4.17</a> -     * Verify that the layout parameters are consistent with
<a id="l4.18" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.18">    4.18</a> -     * the data.  If strictCheck
<a id="l4.19" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.19">    4.19</a> -     * is false, this method will check for ArrayIndexOutOfBounds conditions.  If
<a id="l4.20" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.20">    4.20</a> -     * strictCheck is true, this method will check for additional error
<a id="l4.21" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.21">    4.21</a> -     * conditions such as line wraparound (width of a line greater than
<a id="l4.22" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.22">    4.22</a> -     * the scanline stride).
<a id="l4.23" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.23">    4.23</a> -     * @return   String   Error string, if the layout is incompatible with
<a id="l4.24" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.24">    4.24</a> -     *                    the data.  Otherwise returns null.
<a id="l4.25" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.25">    4.25</a> -     */
<a id="l4.26" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.26">    4.26</a> -    private void verify (boolean strictCheck) {
<a id="l4.27" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.27">    4.27</a> -        int maxSize = 0;
<a id="l4.28" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.28">    4.28</a> -        int size;
<a id="l4.29" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.29">    4.29</a> -
<a id="l4.30" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.30">    4.30</a> -        size = (height-1)*scanlineStride + (width-1) + dataOffsets[0];
<a id="l4.31" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.31">    4.31</a> -        if (size &gt; maxSize) {
<a id="l4.32" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.32">    4.32</a> -            maxSize = size;
<a id="l4.33" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.33">    4.33</a> -        }
<a id="l4.34" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.34">    4.34</a> -        if (data.length &lt; maxSize) {
<a id="l4.35" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.35">    4.35</a> -            throw new RasterFormatException("Data array too small (should be "+
<a id="l4.36" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.36">    4.36</a> -                                          maxSize
<a id="l4.37" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.37">    4.37</a> -                                          +" but is "+data.length+" )");
<a id="l4.38" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.38">    4.38</a> -        }
<a id="l4.39" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.39">    4.39</a> -    }
<a id="l4.40" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.40">    4.40</a> -
<a id="l4.41" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.41">    4.41</a>      public String toString() {
<a id="l4.42" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.42">    4.42</a>          return new String ("IntegerInterleavedRaster: width = "+width
<a id="l4.43" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l4.43">    4.43</a>                             +" height = " + height</pre>
</div>
<div>
<pre><a id="l5.1" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l5.1">     5.1</a> --- a/src/share/classes/sun/awt/image/ShortComponentRaster.java	Tue Dec 04 14:02:08 2012 +0000
<a id="l5.2" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l5.2">     5.2</a> +++ b/src/share/classes/sun/awt/image/ShortComponentRaster.java	Thu Feb 14 19:51:51 2013 +0400
<a id="l5.3" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l5.3">     5.3</a> @@ -802,6 +802,15 @@
<a id="l5.4" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l5.4">     5.4</a>       * or if data buffer has not enough capacity.
<a id="l5.5" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l5.5">     5.5</a>       */
<a id="l5.6" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l5.6">     5.6</a>      protected final void verify() {
<a id="l5.7" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l5.7">     5.7</a> +        /* Need to re-verify the dimensions since a sample model may be
<a id="l5.8" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l5.8">     5.8</a> +         * specified to the constructor
<a id="l5.9" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l5.9">     5.9</a> +         */
<a id="l5.10" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l5.10">    5.10</a> +        if (width &lt;= 0 || height &lt;= 0 ||
<a id="l5.11" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l5.11">    5.11</a> +            height &gt; (Integer.MAX_VALUE / width))
<a id="l5.12" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l5.12">    5.12</a> +        {
<a id="l5.13" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l5.13">    5.13</a> +            throw new RasterFormatException("Invalid raster dimension");
<a id="l5.14" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l5.14">    5.14</a> +        }
<a id="l5.15" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l5.15">    5.15</a> +
<a id="l5.16" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l5.16">    5.16</a>          for (int i = 0; i &lt; dataOffsets.length; i++) {
<a id="l5.17" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l5.17">    5.17</a>              if (dataOffsets[i] &lt; 0) {
<a id="l5.18" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l5.18">    5.18</a>                  throw new RasterFormatException("Data offsets for band " + i
<a id="l5.19" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l5.19">    5.19</a> @@ -839,12 +848,13 @@
<a id="l5.20" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l5.20">    5.20</a>          lastPixelOffset += lastScanOffset;
<a id="l5.21" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l5.21">    5.21</a>  
<a id="l5.22" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l5.22">    5.22</a>          for (int i = 0; i &lt; numDataElements; i++) {
<a id="l5.23" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l5.23">    5.23</a> -            size = lastPixelOffset + dataOffsets[i];
<a id="l5.24" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l5.24">    5.24</a>              if (dataOffsets[i] &gt; (Integer.MAX_VALUE - lastPixelOffset)) {
<a id="l5.25" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l5.25">    5.25</a>                  throw new RasterFormatException("Incorrect band offset: "
<a id="l5.26" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l5.26">    5.26</a>                              + dataOffsets[i]);
<a id="l5.27" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l5.27">    5.27</a>              }
<a id="l5.28" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l5.28">    5.28</a>  
<a id="l5.29" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l5.29">    5.29</a> +            size = lastPixelOffset + dataOffsets[i];
<a id="l5.30" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l5.30">    5.30</a> +
<a id="l5.31" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l5.31">    5.31</a>              if (size &gt; maxSize) {
<a id="l5.32" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l5.32">    5.32</a>                  maxSize = size;
<a id="l5.33" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l5.33">    5.33</a>              }</pre>
</div>
<div>
<pre><a id="l6.1" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l6.1">     6.1</a> --- a/src/share/native/sun/awt/image/awt_parseImage.c	Tue Dec 04 14:02:08 2012 +0000
<a id="l6.2" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l6.2">     6.2</a> +++ b/src/share/native/sun/awt/image/awt_parseImage.c	Thu Feb 14 19:51:51 2013 +0400
<a id="l6.3" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l6.3">     6.3</a> @@ -34,6 +34,7 @@
<a id="l6.4" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l6.4">     6.4</a>  #include "java_awt_color_ColorSpace.h"
<a id="l6.5" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l6.5">     6.5</a>  #include "awt_Mlib.h"
<a id="l6.6" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l6.6">     6.6</a>  #include "safe_alloc.h"
<a id="l6.7" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l6.7">     6.7</a> +#include "safe_math.h"
<a id="l6.8" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l6.8">     6.8</a>  
<a id="l6.9" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l6.9">     6.9</a>  static int setHints(JNIEnv *env, BufImageS_t *imageP);
<a id="l6.10" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l6.10">    6.10</a></pre>
</div>
<div>
<pre><a id="l7.1" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.1">     7.1</a> --- a/src/share/native/sun/awt/medialib/awt_ImagingLib.c	Tue Dec 04 14:02:08 2012 +0000
<a id="l7.2" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.2">     7.2</a> +++ b/src/share/native/sun/awt/medialib/awt_ImagingLib.c	Thu Feb 14 19:51:51 2013 +0400
<a id="l7.3" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.3">     7.3</a> @@ -42,6 +42,7 @@
<a id="l7.4" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.4">     7.4</a>  #include "awt_Mlib.h"
<a id="l7.5" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.5">     7.5</a>  #include "gdefs.h"
<a id="l7.6" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.6">     7.6</a>  #include "safe_alloc.h"
<a id="l7.7" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.7">     7.7</a> +#include "safe_math.h"
<a id="l7.8" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.8">     7.8</a>  
<a id="l7.9" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.9">     7.9</a>  /***************************************************************************
<a id="l7.10" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.10">    7.10</a>   *                               Definitions                               *
<a id="l7.11" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.11">    7.11</a> @@ -1993,13 +1994,23 @@
<a id="l7.12" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.12">    7.12</a>      unsigned char *dP = dataP;
<a id="l7.13" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.13">    7.13</a>  #define NUM_LINES    10
<a id="l7.14" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.14">    7.14</a>      int numLines = NUM_LINES;
<a id="l7.15" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.15">    7.15</a> -    int nbytes = rasterP-&gt;width*4*NUM_LINES;
<a id="l7.16" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.16">    7.16</a> +    /* it is safe to calculate the scan length, because width has been verified
<a id="l7.17" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.17">    7.17</a> +     * on creation of the mlib image
<a id="l7.18" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.18">    7.18</a> +     */
<a id="l7.19" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.19">    7.19</a> +    int scanLength = rasterP-&gt;width * 4;
<a id="l7.20" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.20">    7.20</a> +
<a id="l7.21" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.21">    7.21</a> +    int nbytes = 0;
<a id="l7.22" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.22">    7.22</a> +    if (!SAFE_TO_MULT(numLines, scanLength)) {
<a id="l7.23" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.23">    7.23</a> +        return -1;
<a id="l7.24" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.24">    7.24</a> +    }
<a id="l7.25" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.25">    7.25</a> +
<a id="l7.26" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.26">    7.26</a> +    nbytes = numLines * scanLength;
<a id="l7.27" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.27">    7.27</a>  
<a id="l7.28" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.28">    7.28</a>      for (y=0; y &lt; rasterP-&gt;height; y+=numLines) {
<a id="l7.29" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.29">    7.29</a>          /* getData, one scanline at a time */
<a id="l7.30" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.30">    7.30</a>          if (y+numLines &gt; rasterP-&gt;height) {
<a id="l7.31" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.31">    7.31</a>              numLines = rasterP-&gt;height - y;
<a id="l7.32" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.32">    7.32</a> -            nbytes = rasterP-&gt;width*4*numLines;
<a id="l7.33" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.33">    7.33</a> +            nbytes = numLines * scanLength;
<a id="l7.34" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.34">    7.34</a>          }
<a id="l7.35" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.35">    7.35</a>          jpixels = (*env)-&gt;CallObjectMethod(env, imageP-&gt;jimage,
<a id="l7.36" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.36">    7.36</a>                                             g_BImgGetRGBMID, 0, y,
<a id="l7.37" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.37">    7.37</a> @@ -2129,8 +2140,14 @@
<a id="l7.38" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.38">    7.38</a>      if (cvtToDefault) {
<a id="l7.39" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.39">    7.39</a>          int status = 0;
<a id="l7.40" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.40">    7.40</a>          *mlibImagePP = (*sMlibSysFns.createFP)(MLIB_BYTE, 4, width, height);
<a id="l7.41" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.41">    7.41</a> +        if (*mlibImagePP == NULL) {
<a id="l7.42" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.42">    7.42</a> +            return -1;
<a id="l7.43" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.43">    7.43</a> +        }
<a id="l7.44" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.44">    7.44</a>          cDataP  = (unsigned char *) mlib_ImageGetData(*mlibImagePP);
<a id="l7.45" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.45">    7.45</a> -        /* Make sure the image is cleared */
<a id="l7.46" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.46">    7.46</a> +        /* Make sure the image is cleared.
<a id="l7.47" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.47">    7.47</a> +         * NB: the image dimension is already verified, so we can
<a id="l7.48" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.48">    7.48</a> +         * safely calculate the length of the buffer.
<a id="l7.49" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.49">    7.49</a> +         */
<a id="l7.50" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.50">    7.50</a>          memset(cDataP, 0, width*height*4);
<a id="l7.51" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.51">    7.51</a>  
<a id="l7.52" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.52">    7.52</a>          if (!isSrc) {
<a id="l7.53" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.53">    7.53</a> @@ -2380,6 +2397,9 @@
<a id="l7.54" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.54">    7.54</a>      case sun_awt_image_IntegerComponentRaster_TYPE_BYTE_PACKED_SAMPLES:
<a id="l7.55" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.55">    7.55</a>          *mlibImagePP = (*sMlibSysFns.createFP)(MLIB_BYTE, rasterP-&gt;numBands,
<a id="l7.56" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.56">    7.56</a>                                          width, height);
<a id="l7.57" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.57">    7.57</a> +        if (*mlibImagePP == NULL) {
<a id="l7.58" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.58">    7.58</a> +            return -1;
<a id="l7.59" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.59">    7.59</a> +        }
<a id="l7.60" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.60">    7.60</a>          if (!isSrc) return 0;
<a id="l7.61" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.61">    7.61</a>          cDataP  = (unsigned char *) mlib_ImageGetData(*mlibImagePP);
<a id="l7.62" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.62">    7.62</a>          return expandPackedBCR(env, rasterP, -1, cDataP);
<a id="l7.63" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.63">    7.63</a> @@ -2388,6 +2408,9 @@
<a id="l7.64" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.64">    7.64</a>          if (rasterP-&gt;sppsm.maxBitSize &lt;= 8) {
<a id="l7.65" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.65">    7.65</a>              *mlibImagePP = (*sMlibSysFns.createFP)(MLIB_BYTE, rasterP-&gt;numBands,
<a id="l7.66" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.66">    7.66</a>                                              width, height);
<a id="l7.67" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.67">    7.67</a> +            if (*mlibImagePP == NULL) {
<a id="l7.68" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.68">    7.68</a> +                return -1;
<a id="l7.69" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.69">    7.69</a> +            }
<a id="l7.70" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.70">    7.70</a>              if (!isSrc) return 0;
<a id="l7.71" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.71">    7.71</a>              cDataP  = (unsigned char *) mlib_ImageGetData(*mlibImagePP);
<a id="l7.72" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.72">    7.72</a>              return expandPackedSCR(env, rasterP, -1, cDataP);
<a id="l7.73" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.73">    7.73</a> @@ -2397,6 +2420,9 @@
<a id="l7.74" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.74">    7.74</a>          if (rasterP-&gt;sppsm.maxBitSize &lt;= 8) {
<a id="l7.75" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.75">    7.75</a>              *mlibImagePP = (*sMlibSysFns.createFP)(MLIB_BYTE, rasterP-&gt;numBands,
<a id="l7.76" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.76">    7.76</a>                                              width, height);
<a id="l7.77" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.77">    7.77</a> +            if (*mlibImagePP == NULL) {
<a id="l7.78" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.78">    7.78</a> +                return -1;
<a id="l7.79" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.79">    7.79</a> +            }
<a id="l7.80" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.80">    7.80</a>              if (!isSrc) return 0;
<a id="l7.81" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.81">    7.81</a>              cDataP  = (unsigned char *) mlib_ImageGetData(*mlibImagePP);
<a id="l7.82" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l7.82">    7.82</a>              return expandPackedICR(env, rasterP, -1, cDataP);</pre>
</div>
<div>
<pre><a id="l8.1" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.1">     8.1</a> --- a/src/share/native/sun/awt/medialib/mlib_ImageCreate.c	Tue Dec 04 14:02:08 2012 +0000
<a id="l8.2" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.2">     8.2</a> +++ b/src/share/native/sun/awt/medialib/mlib_ImageCreate.c	Thu Feb 14 19:51:51 2013 +0400
<a id="l8.3" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.3">     8.3</a> @@ -120,6 +120,7 @@
<a id="l8.4" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.4">     8.4</a>  #include "mlib_image.h"
<a id="l8.5" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.5">     8.5</a>  #include "mlib_ImageRowTable.h"
<a id="l8.6" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.6">     8.6</a>  #include "mlib_ImageCreate.h"
<a id="l8.7" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.7">     8.7</a> +#include "safe_math.h"
<a id="l8.8" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.8">     8.8</a>  
<a id="l8.9" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.9">     8.9</a>  /***************************************************************/
<a id="l8.10" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.10">    8.10</a>  mlib_image* mlib_ImageSet(mlib_image *image,
<a id="l8.11" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.11">    8.11</a> @@ -247,28 +248,50 @@
<a id="l8.12" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.12">    8.12</a>      return NULL;
<a id="l8.13" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.13">    8.13</a>    };
<a id="l8.14" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.14">    8.14</a>  
<a id="l8.15" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.15">    8.15</a> +  if (!SAFE_TO_MULT(width, channels)) {
<a id="l8.16" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.16">    8.16</a> +    return NULL;
<a id="l8.17" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.17">    8.17</a> +  }
<a id="l8.18" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.18">    8.18</a> +
<a id="l8.19" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.19">    8.19</a> +  wb = width * channels;
<a id="l8.20" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.20">    8.20</a> +
<a id="l8.21" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.21">    8.21</a>    switch (type) {
<a id="l8.22" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.22">    8.22</a>      case MLIB_DOUBLE:
<a id="l8.23" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.23">    8.23</a> -      wb = width * channels * 8;
<a id="l8.24" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.24">    8.24</a> +      if (!SAFE_TO_MULT(wb, 8)) {
<a id="l8.25" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.25">    8.25</a> +        return NULL;
<a id="l8.26" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.26">    8.26</a> +      }
<a id="l8.27" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.27">    8.27</a> +      wb *= 8;
<a id="l8.28" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.28">    8.28</a>        break;
<a id="l8.29" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.29">    8.29</a>      case MLIB_FLOAT:
<a id="l8.30" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.30">    8.30</a>      case MLIB_INT:
<a id="l8.31" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.31">    8.31</a> -      wb = width * channels * 4;
<a id="l8.32" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.32">    8.32</a> +      if (!SAFE_TO_MULT(wb, 4)) {
<a id="l8.33" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.33">    8.33</a> +        return NULL;
<a id="l8.34" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.34">    8.34</a> +      }
<a id="l8.35" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.35">    8.35</a> +      wb *= 4;
<a id="l8.36" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.36">    8.36</a>        break;
<a id="l8.37" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.37">    8.37</a>      case MLIB_USHORT:
<a id="l8.38" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.38">    8.38</a>      case MLIB_SHORT:
<a id="l8.39" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.39">    8.39</a> -      wb = width * channels * 2;
<a id="l8.40" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.40">    8.40</a> +      if (!SAFE_TO_MULT(wb, 4)) {
<a id="l8.41" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.41">    8.41</a> +        return NULL;
<a id="l8.42" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.42">    8.42</a> +      }
<a id="l8.43" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.43">    8.43</a> +      wb *= 2;
<a id="l8.44" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.44">    8.44</a>        break;
<a id="l8.45" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.45">    8.45</a>      case MLIB_BYTE:
<a id="l8.46" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.46">    8.46</a> -      wb = width * channels;
<a id="l8.47" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.47">    8.47</a> +      // wb is ready
<a id="l8.48" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.48">    8.48</a>        break;
<a id="l8.49" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.49">    8.49</a>      case MLIB_BIT:
<a id="l8.50" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.50">    8.50</a> -      wb = (width * channels + 7) / 8;
<a id="l8.51" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.51">    8.51</a> +      if (!SAFE_TO_ADD(7, wb)) {
<a id="l8.52" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.52">    8.52</a> +        return NULL;
<a id="l8.53" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.53">    8.53</a> +      }
<a id="l8.54" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.54">    8.54</a> +      wb = (wb + 7) / 8;
<a id="l8.55" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.55">    8.55</a>        break;
<a id="l8.56" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.56">    8.56</a>      default:
<a id="l8.57" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.57">    8.57</a>        return NULL;
<a id="l8.58" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.58">    8.58</a>    }
<a id="l8.59" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.59">    8.59</a>  
<a id="l8.60" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.60">    8.60</a> +  if (!SAFE_TO_MULT(wb, height)) {
<a id="l8.61" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.61">    8.61</a> +      return NULL;
<a id="l8.62" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.62">    8.62</a> +  }
<a id="l8.63" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.63">    8.63</a> +
<a id="l8.64" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.64">    8.64</a>    data = mlib_malloc(wb * height);
<a id="l8.65" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.65">    8.65</a>    if (data == NULL) {
<a id="l8.66" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l8.66">    8.66</a>      return NULL;</pre>
</div>
<div>
<pre><a id="l9.1" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l9.1">     9.1</a> --- a/src/share/native/sun/awt/medialib/safe_alloc.h	Tue Dec 04 14:02:08 2012 +0000
<a id="l9.2" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l9.2">     9.2</a> +++ b/src/share/native/sun/awt/medialib/safe_alloc.h	Thu Feb 14 19:51:51 2013 +0400
<a id="l9.3" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l9.3">     9.3</a> @@ -41,10 +41,4 @@
<a id="l9.4" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l9.4">     9.4</a>      (((w) &gt; 0) &amp;&amp; ((h) &gt; 0) &amp;&amp; ((sz) &gt; 0) &amp;&amp;                               \
<a id="l9.5" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l9.5">     9.5</a>       (((0xffffffffu / ((juint)(w))) / ((juint)(h))) &gt; ((juint)(sz))))
<a id="l9.6" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l9.6">     9.6</a>  
<a id="l9.7" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l9.7">     9.7</a> -#define SAFE_TO_MULT(a, b) \
<a id="l9.8" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l9.8">     9.8</a> -    (((a) &gt; 0) &amp;&amp; ((b) &gt;= 0) &amp;&amp; ((0x7fffffff / (a)) &gt; (b)))
<a id="l9.9" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l9.9">     9.9</a> -
<a id="l9.10" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l9.10">    9.10</a> -#define SAFE_TO_ADD(a, b) \
<a id="l9.11" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l9.11">    9.11</a> -    (((a) &gt;= 0) &amp;&amp; ((b) &gt;= 0) &amp;&amp; ((0x7fffffff - (a)) &gt; (b)))
<a id="l9.12" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l9.12">    9.12</a> -
<a id="l9.13" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l9.13">    9.13</a>  #endif // __SAFE_ALLOC_H__</pre>
</div>
<div>
<pre><a id="l10.1" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l10.1">    10.1</a> --- /dev/null	Thu Jan 01 00:00:00 1970 +0000
<a id="l10.2" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l10.2">    10.2</a> +++ b/src/share/native/sun/awt/medialib/safe_math.h	Thu Feb 14 19:51:51 2013 +0400
<a id="l10.3" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l10.3">    10.3</a> @@ -0,0 +1,35 @@
<a id="l10.4" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l10.4">    10.4</a> +/*
<a id="l10.5" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l10.5">    10.5</a> + * Copyright (c) 2013, Oracle and/or its affiliates. All rights reserved.
<a id="l10.6" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l10.6">    10.6</a> + * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
<a id="l10.7" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l10.7">    10.7</a> + *
<a id="l10.8" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l10.8">    10.8</a> + * This code is free software; you can redistribute it and/or modify it
<a id="l10.9" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l10.9">    10.9</a> + * under the terms of the GNU General Public License version 2 only, as
<a id="l10.10" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l10.10">   10.10</a> + * published by the Free Software Foundation.  Oracle designates this
<a id="l10.11" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l10.11">   10.11</a> + * particular file as subject to the "Classpath" exception as provided
<a id="l10.12" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l10.12">   10.12</a> + * by Oracle in the LICENSE file that accompanied this code.
<a id="l10.13" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l10.13">   10.13</a> + *
<a id="l10.14" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l10.14">   10.14</a> + * This code is distributed in the hope that it will be useful, but WITHOUT
<a id="l10.15" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l10.15">   10.15</a> + * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
<a id="l10.16" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l10.16">   10.16</a> + * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
<a id="l10.17" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l10.17">   10.17</a> + * version 2 for more details (a copy is included in the LICENSE file that
<a id="l10.18" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l10.18">   10.18</a> + * accompanied this code).
<a id="l10.19" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l10.19">   10.19</a> + *
<a id="l10.20" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l10.20">   10.20</a> + * You should have received a copy of the GNU General Public License version
<a id="l10.21" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l10.21">   10.21</a> + * 2 along with this work; if not, write to the Free Software Foundation,
<a id="l10.22" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l10.22">   10.22</a> + * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
<a id="l10.23" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l10.23">   10.23</a> + *
<a id="l10.24" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l10.24">   10.24</a> + * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
<a id="l10.25" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l10.25">   10.25</a> + * or visit www.oracle.com if you need additional information or have any
<a id="l10.26" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l10.26">   10.26</a> + * questions.
<a id="l10.27" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l10.27">   10.27</a> + */
<a id="l10.28" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l10.28">   10.28</a> +
<a id="l10.29" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l10.29">   10.29</a> +#ifndef __SAFE_MATH_H__
<a id="l10.30" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l10.30">   10.30</a> +#define __SAFE_MATH_H__
<a id="l10.31" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l10.31">   10.31</a> +
<a id="l10.32" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l10.32">   10.32</a> +#define SAFE_TO_MULT(a, b) \
<a id="l10.33" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l10.33">   10.33</a> +    (((a) &gt; 0) &amp;&amp; ((b) &gt;= 0) &amp;&amp; ((0x7fffffff / (a)) &gt; (b)))
<a id="l10.34" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l10.34">   10.34</a> +
<a id="l10.35" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l10.35">   10.35</a> +#define SAFE_TO_ADD(a, b) \
<a id="l10.36" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l10.36">   10.36</a> +    (((a) &gt;= 0) &amp;&amp; ((b) &gt;= 0) &amp;&amp; ((0x7fffffff - (a)) &gt; (b)))
<a id="l10.37" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l10.37">   10.37</a> +
<a id="l10.38" href="http://icedtea.classpath.org/hg/release/icedtea7-forest-2.3/jdk/rev/fa09ada25c47#l10.38">   10.38</a> +#endif // __SAFE_MATH_H__</pre>
</div>
<!-- CONTENT_END -->
        </article>

        <!-- Tags & Share -->
        <div class="mt-12 pt-8 border-t border-gray-200 dark:border-gray-700">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="flex flex-wrap gap-2">
                    <span class="text-sm font-semibold text-gray-500 dark:text-gray-400 mr-2">Tags:</span>
                    <!-- TAGS_START -->
<a href="#" class="px-3 py-1 bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 rounded-full text-sm hover:bg-blue-50 dark:hover:bg-gray-700 hover:text-blue-500 transition">cve-2013-0809</a>

<!-- TAGS_END -->
                </div>
            </div>
        </div>

        <!-- Post Navigation -->
        <!-- POST_NAVIGATION_START -->
<div class="flex flex-col md:flex-row justify-between items-center border-t border-gray-200 dark:border-gray-700 pt-6 mt-8 gap-4">
                <a href="analyzing-cve-2012-6075-qemu-e1000-driver-buffer-overflow-when-processing-large-packets-when-sbp-and-lpe-flags-are-disabled.html" class="flex items-center text-gray-600 dark:text-gray-400 hover:text-blue-500 dark:hover:text-blue-400 transition group text-left w-full md:w-1/2">
                    <i class="fas fa-arrow-left mr-3 group-hover:-translate-x-1 transition-transform"></i>
                    <div>
                        <span class="text-xs font-bold uppercase tracking-wider text-gray-500 block mb-1">Previous</span>
                        <span class="font-semibold line-clamp-1">Analyzing CVE-2012-6075 qemu: e1000 driver buffer overflow when processing large packets when SBP and LPE flags are disabled</span>
                    </div>
                </a>
                
                <a href="cve-2013-1488.html" class="flex items-center justify-end text-gray-600 dark:text-gray-400 hover:text-blue-500 dark:hover:text-blue-400 transition group text-right w-full md:w-1/2">
                    <div>
                        <span class="text-xs font-bold uppercase tracking-wider text-gray-500 block mb-1">Next</span>
                        <span class="font-semibold line-clamp-1">CVE-2013-1488 </span>
                    </div>
                    <i class="fas fa-arrow-right ml-3 group-hover:translate-x-1 transition-transform"></i>
                </a>
                </div>
<!-- POST_NAVIGATION_END -->

        <!-- Related Posts -->
        <div class="mt-16 border-t border-gray-200 dark:border-gray-700 pt-10">
            <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">Related Posts</h3>
            <div id="relatedPosts" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Populated by JS -->
            </div>
        </div>

    </main>

    <footer class="bg-gray-100 dark:bg-gray-900 p-8 text-center border-t border-gray-200 dark:border-gray-800 mt-12 transition-colors duration-300">
        <p class="text-gray-500 font-medium text-lg">
            "Fuzzing is not magic; it's persistent, structured execution."
        </p>
        <div class="mt-4 flex justify-center space-x-6 text-2xl">
            <a href="https://twitter.com/hardik05" target="_blank" class="text-gray-500 hover:text-blue-400 transition"><i class="fab fa-twitter"></i></a>
            <a href="https://www.linkedin.com/in/hardik05" target="_blank" class="text-gray-500 hover:text-blue-400 transition"><i class="fab fa-linkedin-in"></i></a>
            <a href="#" class="text-gray-500 hover:text-blue-400 transition"><i class="fab fa-youtube"></i></a>
            <a href="https://github.com/hardik05" target="_blank" class="text-gray-500 hover:text-blue-400 transition"><i class="fab fa-github"></i></a>
        </div>
        <div class="mt-6 text-gray-600 text-xs space-x-4">
            <span>&copy; <span id="current-year">2024</span> Fuzzing.in</span>
            <span id="last-updated"></span>
            <a href="#" class="hover:text-gray-400">Terms</a>
            <a href="#" class="hover:text-gray-400">Privacy</a>
        </div>
    </footer>

    <script src="posts.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const currentTitle = document.querySelector('h1').innerText.trim();
            const relatedContainer = document.getElementById('relatedPosts');
            
            if (!window.blogPosts || !relatedContainer) return;

            // Get current category
            const categoryEl = document.querySelector('header span.uppercase');
            const currentCategory = categoryEl ? categoryEl.innerText.trim() : '';

            // Filter posts
            let related = window.blogPosts.filter(post => 
                post.title !== currentTitle && 
                post.category === currentCategory
            );

            // Fallback to recent if not enough related
            if (related.length < 3) {
                const recent = window.blogPosts.filter(post => post.title !== currentTitle && !related.includes(post));
                related = related.concat(recent).slice(0, 3);
            } else {
                related = related.slice(0, 3);
            }

            relatedContainer.innerHTML = related.map(post => {
                // Fix link for relative path (remove 'blog/' prefix)
                const relativeLink = post.link.replace(/^blog\//, '');
                
                return `
                <a href="${relativeLink}" class="block group">
                    ${post.image ? `<div class="h-40 mb-4 overflow-hidden rounded-lg bg-gray-100 dark:bg-gray-800"><img src="${post.image}" alt="${post.title}" class="w-full h-full object-cover group-hover:scale-105 transition duration-300"></div>` : '<div class="h-40 mb-4 overflow-hidden rounded-lg bg-gray-100 dark:bg-gray-800 flex items-center justify-center text-gray-400"><i class="fas fa-newspaper text-3xl"></i></div>'}
                    <h4 class="font-bold text-gray-900 dark:text-white group-hover:text-blue-400 transition line-clamp-2">${post.title}</h4>
                    <p class="text-sm text-gray-500 dark:text-gray-400 mt-2">${post.date}</p>
                </a>
            `}).join('');
        });

        // Table of Contents Generator
        document.addEventListener('DOMContentLoaded', () => {
            const article = document.querySelector('article');
            const tocContainer = document.getElementById('toc');
            const tocList = document.getElementById('toc-list');
            
            if (!article || !tocContainer || !tocList) return;

            const headings = article.querySelectorAll('h2, h3');
            
            if (headings.length < 2) {
                return; 
            }

            tocContainer.classList.remove('hidden');

            headings.forEach((heading, index) => {
                if (!heading.id) {
                    heading.id = `heading-${index}`;
                }

                const li = document.createElement('li');
                const a = document.createElement('a');
                a.href = `#${heading.id}`;
                a.textContent = heading.innerText;
                a.className = heading.tagName === 'H3' ? 'ml-4 hover:text-blue-500 transition' : 'font-semibold hover:text-blue-500 transition';
                
                li.appendChild(a);
                tocList.appendChild(li);
            });
        });

        // Share Buttons Logic
        document.addEventListener('DOMContentLoaded', () => {
            const url = encodeURIComponent(window.location.href);
            const title = encodeURIComponent(document.title);
            
            document.getElementById('share-twitter').href = `https://twitter.com/intent/tweet?text=${title}&url=${url}`;
            document.getElementById('share-linkedin').href = `https://www.linkedin.com/sharing/share-offsite/?url=${url}`;
            document.getElementById('share-facebook').href = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
            document.getElementById('share-email').href = `mailto:?subject=${title}&body=Check out this article: ${url}`;
            
            document.getElementById('copy-link-btn').addEventListener('click', () => {
                navigator.clipboard.writeText(window.location.href).then(() => {
                    const icon = document.querySelector('#copy-link-btn i');
                    icon.className = 'fas fa-check text-emerald-500';
                    setTimeout(() => {
                        icon.className = 'fas fa-link';
                    }, 2000);
                });
            });
        });
    </script>
</body>
</html>